# 营养分析功能使用指南

## 功能概述

营养分析功能允许用户通过上传文件（图片、文本、PDF）或直接输入文本来分析食物的营养成分。该功能调用独立的 Dify 智能体来提供专业的营养分析服务。

## 功能特点

- 📁 **文件上传分析**：支持图片（JPG、PNG）、文本文件（TXT）和PDF文件
- ✏️ **文本输入分析**：直接输入食物信息进行分析
- 📊 **详细营养报告**：提供热量、蛋白质、脂肪、碳水化合物、维生素和矿物质等详细信息
- 💾 **历史记录**：自动保存分析历史，方便回顾
- 📤 **结果分享**：支持分享分析结果
- 📱 **响应式设计**：支持移动端和桌面端

## 配置说明

### 1. 环境变量配置

在 `.env` 文件中添加以下配置：

```env
# Dify 营养分析智能体 API 配置
VITE_NUTRITION_DIFY_API_URL=https://api.dify.ai/v1
VITE_NUTRITION_DIFY_API_KEY=your_nutrition_dify_api_key_here
```

### 2. 获取 API Key

1. 登录 [Dify 控制台](https://dify.ai)
2. 创建一个新的智能体应用，专门用于营养分析
3. 配置智能体的提示词，使其专注于营养分析任务
4. 获取应用的 API Key
5. 将 API Key 填入 `.env` 文件

### 3. 智能体配置建议

为营养分析智能体配置以下提示词模板：

```
你是一个专业的营养分析师。请分析用户提供的食物信息，并提供详细的营养成分分析报告。

分析内容应包括：
1. 食物识别和分量估算
2. 热量计算
3. 主要营养素（蛋白质、脂肪、碳水化合物）
4. 维生素和矿物质含量
5. 营养价值评估
6. 健康建议

请以结构化的方式呈现分析结果，使用 Markdown 格式。
```

## 使用方法

### 1. 访问功能

- 在首页点击「营养分析」功能卡片
- 或直接访问营养分析页面

### 2. 文件上传分析

1. 选择「文件上传」标签页
2. 拖拽文件到上传区域或点击选择文件
3. 支持的文件类型：
   - 图片：JPG、PNG（食物照片）
   - 文本：TXT（食物清单）
   - 文档：PDF（营养标签、菜单等）
4. 文件大小限制：10MB
5. 点击「开始分析」按钮
6. 等待分析完成，查看结果

### 3. 文本输入分析

1. 选择「文本输入」标签页
2. 在文本框中输入食物信息，例如：
   - "一碗白米饭"
   - "100克鸡胸肉"
   - "今天吃了一个苹果、一杯牛奶、一片面包"
3. 文本长度限制：2000字符
4. 点击「开始分析」按钮
5. 等待分析完成，查看结果

### 4. 查看分析结果

分析结果包含：
- 📊 营养成分详细信息
- 📝 分析文件/文本信息
- ⏰ 分析时间
- 💾 保存到历史选项
- 📤 分享结果选项

### 5. 历史记录管理

- 📋 查看所有分析历史
- 🔄 刷新历史列表
- 👁️ 点击历史项目查看详情
- 🗑️ 清空所有历史记录

## 技术实现

### 文件结构

```
src/
├── api/
│   └── nutrition.js          # 营养分析 API
├── components/
│   └── NutritionAnalysis.vue  # 营养分析组件
└── views/
    └── Home.vue              # 首页（包含功能入口）
```

### API 接口

- `analyzeFile(file, options)` - 文件上传分析
- `analyzeText(text, options)` - 文本分析
- `getAnalysisHistory()` - 获取分析历史
- `saveAnalysisToHistory(result)` - 保存到历史
- `clearAnalysisHistory()` - 清空历史

### 数据存储

- 使用 `localStorage` 存储分析历史
- 最多保存 50 条历史记录
- 数据格式：JSON

## 错误处理

### 常见错误及解决方案

1. **API Key 未配置**
   - 错误："营养分析 API Key 未配置"
   - 解决：在 `.env` 文件中正确配置 `VITE_NUTRITION_DIFY_API_KEY`

2. **文件类型不支持**
   - 错误："不支持的文件类型"
   - 解决：确保上传的是 JPG、PNG、TXT 或 PDF 文件

3. **文件过大**
   - 错误："文件大小不能超过10MB"
   - 解决：压缩文件或选择较小的文件

4. **网络请求失败**
   - 错误："网络请求失败"
   - 解决：检查网络连接和 API 服务状态

5. **API 响应错误**
   - 错误："营养分析API错误"
   - 解决：检查 API Key 是否正确，智能体是否正常运行

## 性能优化

- 文件上传支持进度显示
- 大文件分块上传
- 结果缓存机制
- 响应式设计适配移动端

## 安全考虑

- API Key 通过环境变量配置，不暴露在代码中
- 文件类型和大小限制
- 输入内容长度限制
- 错误信息不暴露敏感信息

## 扩展功能

未来可以考虑添加：

- 🍽️ 餐食搭配建议
- 📈 营养趋势分析
- 🎯 个性化营养目标
- 📊 营养数据可视化
- 🔄 与食谱推荐系统集成
- 📱 移动端 App
- 🤖 语音输入支持

## 支持与反馈

如果在使用过程中遇到问题，请：

1. 检查控制台错误信息
2. 确认 API 配置是否正确
3. 查看网络请求状态
4. 联系技术支持团队